(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4069:(e,t,a)=>{Promise.resolve().then(a.bind(a,9450))},9450:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eD});var r=a(5155),s=a(2115),l=a(3961),i=a(3591),o=a(1025),n=a(6809),d=a(3545),c=a(1958),x=a(232),u=a(1585),p=a(1934);let m={code:`# Paste your Keras model code here
# Example (the motivating example from the DEFault paper):

import tensorflow as tf
from tensorflow.keras import Sequential
from tensorflow.keras.layers import (
    Conv2D, Activation, MaxPooling2D,
    Flatten, Dense, Dropout
)

def build_model():
    model = Sequential([
        Conv2D(32, (3, 3), input_shape=(28, 28, 1)),
        Activation('relu'),
        MaxPooling2D(pool_size=(2, 2)),
        Flatten(),
        Dense(64),
        Activation('relu'),
        Dropout(0.5),
        Dense(1),
        Activation('sigmoid'),   # ← DEFault will flag this
    ])
    model.compile(
        loss='binary_crossentropy',
        optimizer='rmsprop',
        metrics=['accuracy']
    )
    return model
`,modelName:"my_model",mode:"idle",currentStage:0,codeResult:null,fullResult:null,error:null,warnings:[],taxonomy:null,dataMode:"dummy",uploadedFile:null,trainingEpochs:5,numSamples:200,liveMetrics:[],trainingProgress:null,isDummyData:!1,abortController:null},h=(0,p.v)(e=>({...m,loadSession:t=>e({code:t.code,modelName:t.modelName,dataMode:t.dataMode,trainingEpochs:t.trainingEpochs,numSamples:t.numSamples,fullResult:t.fullResult,codeResult:t.codeResult,liveMetrics:t.liveMetrics,isDummyData:t.isDummyData,mode:t.fullResult?"done_training":t.codeResult?"done_static":"idle",error:null,warnings:t.fullResult?.warnings??t.codeResult?.warnings??[],currentStage:0}),setCode:t=>e({code:t}),setModelName:t=>e({modelName:t}),setMode:t=>e({mode:t}),setCurrentStage:t=>e({currentStage:t}),setCodeResult:t=>e({codeResult:t}),setFullResult:t=>e({fullResult:t}),setError:t=>e({error:t}),setWarnings:t=>e({warnings:t}),setTaxonomy:t=>e({taxonomy:t}),setDataMode:t=>e({dataMode:t}),setUploadedFile:t=>e({uploadedFile:t}),setTrainingConfig:t=>e(e=>({trainingEpochs:t.epochs??e.trainingEpochs,numSamples:t.numSamples??e.numSamples,dataMode:t.dataMode??e.dataMode})),appendEpochMetric:t=>e(e=>({liveMetrics:[...e.liveMetrics,t],trainingProgress:{current:t.epoch,total:t.total}})),setTrainingProgress:t=>e({trainingProgress:t}),setIsDummyData:t=>e({isDummyData:t}),setAbortController:t=>e({abortController:t}),resetTraining:()=>e({liveMetrics:[],trainingProgress:null,isDummyData:!1,abortController:null}),reset:()=>e(e=>({...m,code:e.code,modelName:e.modelName,taxonomy:e.taxonomy,dataMode:e.dataMode,trainingEpochs:e.trainingEpochs,numSamples:e.numSamples}))}));async function f(e,t){let a=await fetch(`${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){let e=await a.json().catch(()=>({detail:a.statusText}));throw Error("string"==typeof e.detail?e.detail:JSON.stringify(e.detail))}return a.json()}async function g(e){let t=await fetch(`${e}`);if(!t.ok){let e=await t.json().catch(()=>({detail:t.statusText}));throw Error("string"==typeof e.detail?e.detail:JSON.stringify(e.detail))}return t.json()}async function v(e,t="pasted_model"){return f("/api/analyze-code",{code:e,model_name:t})}async function y(){return g("/api/fault-taxonomy")}async function*b(e,t){let a=new FormData;a.append("code",e.code),a.append("model_name",e.modelName),a.append("data_mode",e.dataMode),a.append("epochs",String(e.epochs)),a.append("num_samples",String(e.numSamples)),e.datasetFile&&a.append("dataset_file",e.datasetFile);let r=await fetch("/api/train-and-diagnose",{method:"POST",body:a,signal:t});if(!r.ok){let e=await r.json().catch(()=>({detail:r.statusText}));throw Error("string"==typeof e.detail?e.detail:JSON.stringify(e.detail))}let s=r.body.getReader(),l=new TextDecoder,i="";for(;;){let{done:e,value:t}=await s.read();if(e)break;let a=(i+=l.decode(t,{stream:!0})).split("\n\n");for(let e of(i=a.pop()??"",a)){let t=e.trim();if(t.startsWith("data: "))try{yield JSON.parse(t.slice(6))}catch{}}}if(i.trim().startsWith("data: "))try{yield JSON.parse(i.trim().slice(6))}catch{}}let j="default-tool-sessions";function N(){try{return JSON.parse(localStorage.getItem(j)??"[]")}catch{return[]}}function k(e){let t={...e,id:`s-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,savedAt:new Date().toISOString()},a=N().filter(e=>e.name!==t.name);return localStorage.setItem(j,JSON.stringify([t,...a].slice(0,10))),t}var w=a(4514),S=a(2129),z=a(6962),C=a(5243),A=a(3210),F=a(4980),_=a(8459);function D({currentState:e,onLoad:t,isRunning:a,hasResults:l}){let[i,o]=(0,s.useState)(!1),[n,d]=(0,s.useState)([]),[c,x]=(0,s.useState)(""),[u,p]=(0,s.useState)(!1),[m,h]=(0,s.useState)(null),f=(0,s.useRef)(null),g=(0,s.useRef)(null);(0,s.useEffect)(()=>{i&&d(N())},[i]),(0,s.useEffect)(()=>{function e(e){f.current&&!f.current.contains(e.target)&&(o(!1),p(!1))}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,s.useEffect)(()=>{u&&g.current?.focus()},[u]);let v=(0,s.useCallback)(t=>{let a=t.trim()||`Session ${new Date().toLocaleTimeString()}`;k({...e,name:a}),d(N()),x(""),p(!1),h(a),setTimeout(()=>h(null),2500)},[e]);return(0,s.useEffect)(()=>{function e(e){(e.metaKey||e.ctrlKey)&&"s"===e.key&&(e.preventDefault(),a||(o(!0),p(!0)))}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a]),(0,r.jsxs)("div",{ref:f,className:"relative",style:{zIndex:50},children:[(0,r.jsx)("button",{className:"btn-ghost flex items-center gap-1.5 text-[11px] px-2.5 py-1.5 rounded-md",onClick:()=>{o(e=>!e),p(!1)},"aria-label":"Open session manager","aria-expanded":i,"aria-haspopup":"true",title:"Sessions (⌘S to save)",children:m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w.A,{size:12,"aria-hidden":"true",style:{color:"var(--safe-green)"}}),(0,r.jsx)("span",{style:{color:"var(--safe-green)"},children:"Saved"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(S.A,{size:12,"aria-hidden":"true"}),(0,r.jsx)("span",{children:"Sessions"})]})}),i&&(0,r.jsxs)("div",{className:"absolute right-0 top-full mt-1.5 rounded-xl shadow-panel overflow-hidden animate-fade-in",style:{width:280,background:"var(--bg-overlay)",border:"1px solid var(--border)"},role:"dialog","aria-label":"Session manager",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-3 py-2.5",style:{borderBottom:"1px solid var(--border-subtle)"},children:[(0,r.jsx)("span",{className:"text-[11px] font-semibold uppercase tracking-widest",style:{color:"var(--text-muted)"},children:"Sessions"}),(0,r.jsxs)("div",{className:"flex gap-1",children:[l&&(0,r.jsx)("button",{className:"btn-ghost p-1 rounded",onClick:()=>{var t;let a,r,s;a=new Blob([JSON.stringify(t=N().find(e=>e.fullResult||e.codeResult)??{...e,id:`export-${Date.now()}`,name:"Export",savedAt:new Date().toISOString()},null,2)],{type:"application/json"}),r=URL.createObjectURL(a),(s=document.createElement("a")).href=r,s.download=`default-${t.modelName.replace(/\s+/g,"_")}-${t.savedAt.slice(0,10)}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r),o(!1)},title:"Export current results as JSON","aria-label":"Export results as JSON",children:(0,r.jsx)(z.A,{size:12,"aria-hidden":"true"})}),(0,r.jsx)("button",{className:"btn-ghost p-1 rounded flex items-center gap-1 text-[11px]",onClick:()=>p(e=>!e),disabled:a,title:"Save session (⌘S)","aria-label":"Save current session",children:(0,r.jsx)(C.A,{size:12,"aria-hidden":"true"})})]})]}),u&&(0,r.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2",style:{borderBottom:"1px solid var(--border-subtle)",background:"var(--bg-card)"},children:[(0,r.jsx)("input",{ref:g,className:"flex-1 text-xs px-2 py-1 rounded-md font-mono",style:{background:"var(--bg-input)",border:"1px solid var(--border)",color:"var(--text-primary)",outline:"none"},placeholder:"Session name…",value:c,onChange:e=>x(e.target.value),onKeyDown:e=>{"Enter"===e.key&&v(c),"Escape"===e.key&&(p(!1),x(""))},"aria-label":"Session name"}),(0,r.jsx)("button",{className:"p-1 rounded",style:{color:"var(--safe-green)"},onClick:()=>v(c),"aria-label":"Confirm save",title:"Save (Enter)",children:(0,r.jsx)(w.A,{size:13,"aria-hidden":"true"})}),(0,r.jsx)("button",{className:"p-1 rounded",style:{color:"var(--text-muted)"},onClick:()=>{p(!1),x("")},"aria-label":"Cancel",title:"Cancel (Esc)",children:(0,r.jsx)(A.A,{size:13,"aria-hidden":"true"})})]}),(0,r.jsx)("div",{className:"overflow-y-auto",style:{maxHeight:280},role:"list","aria-label":"Saved sessions",children:0===n.length?(0,r.jsxs)("div",{className:"px-4 py-6 text-center text-[11px]",style:{color:"var(--text-muted)"},children:["No saved sessions yet.",(0,r.jsx)("br",{}),(0,r.jsx)("span",{style:{color:"var(--text-secondary)"},children:"Press ⌘S to save one."})]}):n.map(e=>(0,r.jsxs)("button",{className:"w-full flex items-center gap-3 px-3 py-2.5 text-left transition-colors session-row",onClick:()=>{t(e),o(!1)},role:"listitem","aria-label":`Load session: ${e.name}`,children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"text-xs font-medium truncate",style:{color:"var(--text-primary)"},children:e.name}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-0.5 text-[10px]",style:{color:"var(--text-muted)"},children:[(0,r.jsx)(F.A,{size:9,"aria-hidden":"true"}),(0,r.jsx)("span",{children:function(e){let t=Math.floor((Date.now()-new Date(e).getTime())/6e4);if(t<1)return"just now";if(t<60)return`${t}m ago`;let a=Math.floor(t/60);if(a<24)return`${a}h ago`;let r=Math.floor(a/24);return`${r}d ago`}(e.savedAt)}),(0,r.jsx)("span",{style:{color:"var(--border)"},children:"\xb7"}),(0,r.jsx)("span",{className:"font-mono truncate",style:{color:"var(--text-code)",maxWidth:90},children:e.modelName}),(e.fullResult||e.codeResult)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{style:{color:"var(--border)"},children:"\xb7"}),(0,r.jsx)("span",{style:{color:e.fullResult?.stage1_detection?.predicted_positive?"var(--fault-red)":"var(--safe-green)"},children:e.fullResult?.stage1_detection?.predicted_positive?"fault":"ok"})]})]})]}),(0,r.jsx)("button",{className:"flex-shrink-0 p-1 rounded opacity-0 session-delete transition-opacity",onClick:t=>{var a;let r;return a=e.id,t.stopPropagation(),void(r=N().filter(e=>e.id!==a),localStorage.setItem(j,JSON.stringify(r)),d(N()))},"aria-label":`Delete session ${e.name}`,title:"Delete session",children:(0,r.jsx)(_.A,{size:11,style:{color:"var(--text-muted)"},"aria-hidden":"true"})})]},e.id))}),(0,r.jsxs)("div",{className:"px-3 py-2 text-[9px]",style:{borderTop:"1px solid var(--border-subtle)",color:"var(--text-muted)"},children:["⌘S save \xb7 click row to restore \xb7 ",n.length,"/",10," slots used"]})]})]})}var E=a(7206),M=a(8274),R=a(1975);let L=(0,E.default)(()=>a.e(202).then(a.bind(a,8202)),{loadableGenerated:{webpack:()=>[8202]},ssr:!1});function $({value:e,onChange:t,disabled:a=!1}){let l=(0,s.useRef)(null);return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 border-b",style:{borderColor:"var(--border)",background:"var(--bg-overlay)"},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(M.A,{size:14,style:{color:"var(--text-code)"}}),(0,r.jsx)("span",{className:"text-xs font-medium",style:{color:"var(--text-secondary)",fontFamily:"var(--font-mono)"},children:"model.py"})]}),(0,r.jsxs)("button",{onClick:()=>l.current?.click(),disabled:a,className:"flex items-center gap-1.5 text-xs px-2.5 py-1 rounded-md transition-colors",style:{color:"var(--accent)",border:"1px solid var(--border)",background:"transparent",cursor:a?"not-allowed":"pointer",opacity:a?.5:1},children:[(0,r.jsx)(R.A,{size:12}),"Upload .py"]}),(0,r.jsx)("input",{ref:l,type:"file",accept:".py",className:"hidden",onChange:function(e){let a=e.target.files?.[0];if(!a)return;let r=new FileReader;r.onload=e=>{t(e.target?.result)},r.readAsText(a),e.target.value=""}})]}),(0,r.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,r.jsx)(L,{language:"python",theme:"vs-dark",value:e,onChange:e=>t(e??""),options:{fontSize:13,fontFamily:"JetBrains Mono, Fira Code, monospace",fontLigatures:!0,minimap:{enabled:!1},lineNumbers:"on",scrollBeyondLastLine:!1,renderLineHighlight:"line",wordWrap:"on",padding:{top:12,bottom:12},readOnly:a,smoothScrolling:!0,cursorBlinking:"smooth",bracketPairColorization:{enabled:!0},"semanticHighlighting.enabled":!0}})})]})}var T=a(6088),W=a(1362);function P({dataMode:e,uploadedFile:t,epochs:a,numSamples:l,disabled:i=!1,onDataModeChange:o,onFileChange:n,onEpochsChange:d,onNumSamplesChange:c}){var x;let[p,m]=(0,s.useState)(!0),[h,f]=(0,s.useState)(!1),g=(0,s.useRef)(null);function v(e){let t=e.name.toLowerCase();t.endsWith(".csv")||t.endsWith(".npy")||t.endsWith(".npz")?n(e):alert("Please upload a .csv, .npy, or .npz file.")}return(0,r.jsxs)("div",{className:"rounded-lg overflow-hidden",style:{border:"1px solid var(--border-subtle)",background:"var(--bg-card)"},children:[(0,r.jsxs)("button",{className:"w-full flex items-center justify-between px-3 py-2 text-left",style:{background:"transparent",cursor:"pointer"},onClick:()=>m(e=>!e),disabled:i,children:[(0,r.jsx)("span",{className:"text-[10px] uppercase tracking-widest font-semibold",style:{color:"var(--text-muted)"},children:"Training Configuration"}),p?(0,r.jsx)(T.A,{size:12,style:{color:"var(--text-muted)"}}):(0,r.jsx)(W.A,{size:12,style:{color:"var(--text-muted)"}})]}),p&&(0,r.jsxs)("div",{className:"px-3 pb-3 flex flex-col gap-3",children:[(0,r.jsx)("div",{className:"flex rounded-md overflow-hidden",style:{border:"1px solid var(--border-subtle)"},children:["dummy","uploaded"].map(t=>(0,r.jsx)("button",{className:"flex-1 text-[11px] py-1.5 font-medium transition-all",style:{background:e===t?"var(--accent)":"var(--bg-overlay)",color:e===t?"#fff":"var(--text-muted)",cursor:i?"not-allowed":"pointer"},onClick:()=>!i&&o(t),disabled:i,children:"dummy"===t?"Dummy Data":"Upload Dataset"},t))}),"dummy"===e&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,r.jsx)("span",{className:"text-[10px]",style:{color:"var(--text-secondary)"},children:"Samples"}),(0,r.jsx)("span",{className:"text-[10px] font-mono",style:{color:"var(--text-code)"},children:l})]}),(0,r.jsx)("input",{type:"range",min:50,max:2e3,step:50,value:l,disabled:i,onChange:e=>c(Number(e.target.value)),className:"w-full accent-[var(--accent)]",style:{cursor:i?"not-allowed":"pointer"}})]}),(0,r.jsxs)("div",{className:"flex items-start gap-1.5 text-[10px] px-2 py-1.5 rounded",style:{background:"var(--warn-yellow-bg)",border:"1px solid var(--warn-yellow)",color:"var(--warn-yellow)"},children:[(0,r.jsx)(u.A,{size:10,className:"flex-shrink-0 mt-0.5"}),(0,r.jsxs)("span",{children:["Results will be labeled ",(0,r.jsx)("strong",{children:"SYNTHETIC DATA"})]})]})]}),"uploaded"===e&&(0,r.jsxs)(r.Fragment,{children:[t?(0,r.jsxs)("div",{className:"flex items-center justify-between px-2 py-1.5 rounded text-[11px]",style:{background:"var(--bg-overlay)",border:"1px solid var(--border-subtle)"},children:[(0,r.jsxs)("span",{style:{color:"var(--text-secondary)"},className:"truncate mr-2",children:[t.name,(0,r.jsxs)("span",{className:"ml-1",style:{color:"var(--text-muted)"},children:["(",(x=t.size)<1024?`${x} B`:x<1048576?`${(x/1024).toFixed(1)} KB`:`${(x/1048576).toFixed(1)} MB`,")"]})]}),(0,r.jsx)("button",{onClick:()=>!i&&n(null),disabled:i,style:{color:"var(--text-muted)",cursor:i?"not-allowed":"pointer"},children:(0,r.jsx)(A.A,{size:12})})]}):(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center gap-1.5 py-4 rounded-lg text-center",style:{border:`1.5px dashed ${h?"var(--accent)":"var(--border-subtle)"}`,background:h?"rgba(88,166,255,0.05)":"transparent",cursor:i?"not-allowed":"pointer",transition:"all 0.15s ease"},onDragOver:e=>{e.preventDefault(),i||f(!0)},onDragLeave:()=>f(!1),onDrop:function(e){if(e.preventDefault(),f(!1),i)return;let t=e.dataTransfer.files[0];t&&v(t)},onClick:()=>!i&&g.current?.click(),children:[(0,r.jsx)(R.A,{size:14,style:{color:"var(--text-muted)"}}),(0,r.jsx)("span",{className:"text-[10px]",style:{color:"var(--text-secondary)"},children:"Drop file or click to upload"}),(0,r.jsx)("span",{className:"text-[9px]",style:{color:"var(--text-muted)"},children:".csv \xb7 .npy \xb7 .npz"}),(0,r.jsx)("input",{ref:g,type:"file",accept:".csv,.npy,.npz",className:"hidden",disabled:i,onChange:e=>{let t=e.target.files?.[0];t&&v(t),e.target.value=""}})]}),(0,r.jsxs)("div",{className:"text-[9px] leading-tight",style:{color:"var(--text-muted)"},children:["CSV: last column = labels. NPZ: use ",(0,r.jsx)("code",{className:"font-mono",children:"X"}),"/",(0,r.jsx)("code",{className:"font-mono",children:"y"})," keys."]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,r.jsx)("span",{className:"text-[10px]",style:{color:"var(--text-secondary)"},children:"Epochs"}),(0,r.jsx)("span",{className:"text-[10px] font-mono",style:{color:"var(--text-code)"},children:a})]}),(0,r.jsx)("input",{type:"range",min:5,max:50,step:1,value:a,disabled:i,onChange:e=>d(Number(e.target.value)),className:"w-full accent-[var(--accent)]",style:{cursor:i?"not-allowed":"pointer"}}),(0,r.jsxs)("div",{className:"flex justify-between text-[9px] mt-0.5",style:{color:"var(--text-muted)"},children:[(0,r.jsx)("span",{children:"5 (quick)"}),(0,r.jsx)("span",{children:"50 (thorough)"})]})]})]})]})}var O=a(1728),I=a(1905),B=a(8408),K=a(2539),H=a(9656),J=a(8021),U=a(1973),q=a(8709),G=a(6894);let V={background:"var(--bg-overlay)",border:"1px solid var(--border)",borderRadius:6,fontSize:11,color:"var(--text-primary)"};function Z({epochs:e,totalEpochs:t,isRunning:a,isDummyData:s}){let l=function(e){let t=[],a=new Set;function r(e){a.has(e.label)||(t.push(e),a.add(e.label))}let s=0;for(let t=0;t<e.length;t++)e[t].acc-e[t].val_acc>.03?2==++s&&r({epoch:t+1,label:"Overfitting",short:"overfit",color:"var(--fault-red)"}):s=0;for(let t=1;t<e.length;t++)e[t-1].loss>0&&e[t].loss>1.2*e[t-1].loss&&r({epoch:t+1,label:"Loss Spike",short:"spike",color:"var(--warn-yellow)"});let l=1;for(let t=1;t<e.length;t++).001>Math.abs(e[t].val_acc-e[t-1].val_acc)?3==++l&&r({epoch:t+1,label:"Plateau",short:"plateau",color:"#79c0ff"}):l=1;return e.length>=5&&e.slice(-5).every(e=>e.acc<.6)&&r({epoch:e[e.length-1].epoch,label:"Underfitting",short:"underfit",color:"#d2a8ff"}),t}(e),i=e[e.length-1],o=e.length/Math.max(t,1),n=e.map(e=>({epoch:e.epoch,loss:+e.loss.toFixed(4),val_loss:+e.val_loss.toFixed(4),acc:+e.acc.toFixed(4),val_acc:+e.val_acc.toFixed(4)}));return(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-[9px] uppercase tracking-widest font-semibold",style:{color:"var(--text-muted)"},children:"Live Training"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[s&&(0,r.jsx)("span",{className:"text-[9px] px-1.5 py-0.5 rounded font-semibold",style:{background:"var(--warn-yellow-bg)",border:"1px solid var(--warn-yellow)",color:"var(--warn-yellow)"},children:"SYNTHETIC DATA"}),a&&(0,r.jsxs)("span",{className:"text-[10px]",style:{color:"var(--text-secondary)"},children:["Epoch ",e.length,"/",t]}),!a&&e.length>0&&(0,r.jsxs)("span",{className:"text-[10px]",style:{color:"var(--safe-green)"},children:["✓ ",e.length," epochs"]})]})]}),(0,r.jsx)("div",{className:"rounded-full overflow-hidden",style:{height:3,background:"var(--bg-overlay)"},children:(0,r.jsx)("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${Math.round(100*o)}%`,background:a?"linear-gradient(90deg, var(--accent), #58a6ff88)":"var(--safe-green)"}})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-1",children:[(0,r.jsx)("span",{className:"text-[9px] uppercase tracking-widest",style:{color:"var(--text-muted)"},children:"Loss"}),(0,r.jsx)(X,{color:"var(--fault-red)",label:"train"}),(0,r.jsx)(X,{color:"var(--warn-yellow)",label:"val",dashed:!0})]}),(0,r.jsx)(O.u,{width:"100%",height:110,children:(0,r.jsxs)(I.b,{data:n,margin:{top:4,right:8,bottom:0,left:0},children:[(0,r.jsx)(B.d,{strokeDasharray:"3 3",stroke:"var(--border-subtle)"}),(0,r.jsx)(K.W,{dataKey:"epoch",tick:{fontSize:9,fill:"var(--text-muted)"},tickLine:!1,axisLine:!1,interval:"preserveEnd"}),(0,r.jsx)(H.h,{tick:{fontSize:9,fill:"var(--text-muted)"},tickLine:!1,axisLine:!1,width:32}),(0,r.jsx)(J.m,{contentStyle:V,labelFormatter:e=>`Epoch ${e}`}),l.map(e=>(0,r.jsx)(U.e_,{x:e.epoch,stroke:e.color,strokeDasharray:"3 3",strokeWidth:1},`loss-a-${e.short}`)),(0,r.jsx)(q.N1,{type:"monotone",dataKey:"loss",stroke:"var(--fault-red)",strokeWidth:1.5,dot:!1,isAnimationActive:!1}),(0,r.jsx)(q.N1,{type:"monotone",dataKey:"val_loss",stroke:"var(--warn-yellow)",strokeWidth:1.5,strokeDasharray:"4 2",dot:!1,isAnimationActive:!1}),a&&i&&(0,r.jsx)(G.r,{x:i.epoch,y:+i.loss.toFixed(4),r:4,fill:"var(--fault-red)",stroke:"var(--bg-card)",strokeWidth:1.5,className:"animate-pulse-live"})]})})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-1",children:[(0,r.jsx)("span",{className:"text-[9px] uppercase tracking-widest",style:{color:"var(--text-muted)"},children:"Accuracy"}),(0,r.jsx)(X,{color:"var(--safe-green)",label:"train"}),(0,r.jsx)(X,{color:"#79c0ff",label:"val",dashed:!0})]}),(0,r.jsx)(O.u,{width:"100%",height:110,children:(0,r.jsxs)(I.b,{data:n,margin:{top:4,right:8,bottom:0,left:0},children:[(0,r.jsx)(B.d,{strokeDasharray:"3 3",stroke:"var(--border-subtle)"}),(0,r.jsx)(K.W,{dataKey:"epoch",tick:{fontSize:9,fill:"var(--text-muted)"},tickLine:!1,axisLine:!1,interval:"preserveEnd"}),(0,r.jsx)(H.h,{tick:{fontSize:9,fill:"var(--text-muted)"},tickLine:!1,axisLine:!1,width:32,domain:[0,1]}),(0,r.jsx)(J.m,{contentStyle:V,labelFormatter:e=>`Epoch ${e}`}),l.map(e=>(0,r.jsx)(U.e_,{x:e.epoch,stroke:e.color,strokeDasharray:"3 3",strokeWidth:1},`acc-a-${e.short}`)),(0,r.jsx)(q.N1,{type:"monotone",dataKey:"acc",stroke:"var(--safe-green)",strokeWidth:1.5,dot:!1,isAnimationActive:!1}),(0,r.jsx)(q.N1,{type:"monotone",dataKey:"val_acc",stroke:"#79c0ff",strokeWidth:1.5,strokeDasharray:"4 2",dot:!1,isAnimationActive:!1}),a&&i&&(0,r.jsx)(G.r,{x:i.epoch,y:+i.acc.toFixed(4),r:4,fill:"var(--safe-green)",stroke:"var(--bg-card)",strokeWidth:1.5,className:"animate-pulse-live"})]})})]}),l.length>0&&(0,r.jsx)("div",{className:"flex flex-col gap-1 mt-1",children:l.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-2 px-2 py-1 rounded text-[10px]",style:{borderLeft:`3px solid ${e.color}`,background:"var(--bg-overlay)",color:"var(--text-secondary)"},children:[(0,r.jsx)("span",{style:{color:e.color,fontWeight:600},children:e.label}),(0,r.jsxs)("span",{style:{color:"var(--text-muted)"},children:["detected at epoch ",e.epoch]})]},e.label))}),i&&(0,r.jsx)("div",{className:"grid grid-cols-4 gap-1 mt-0.5 text-center rounded py-1.5",style:{background:"var(--bg-overlay)"},children:[{label:"Loss",value:i.loss.toFixed(3),color:"var(--fault-red)"},{label:"Val Loss",value:i.val_loss.toFixed(3),color:"var(--warn-yellow)"},{label:"Acc",value:(100*i.acc).toFixed(1)+"%",color:"var(--safe-green)"},{label:"Val Acc",value:(100*i.val_acc).toFixed(1)+"%",color:"#79c0ff"}].map(e=>(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"text-[8px] uppercase tracking-widest",style:{color:"var(--text-muted)"},children:e.label}),(0,r.jsx)("span",{className:"text-[11px] font-mono font-semibold",style:{color:e.color},children:e.value})]},e.label))})]})}function X({color:e,label:t,dashed:a=!1}){return(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("svg",{width:14,height:6,children:(0,r.jsx)("line",{x1:"0",y1:"3",x2:"14",y2:"3",stroke:e,strokeWidth:2,strokeDasharray:a?"3 2":void 0})}),(0,r.jsx)("span",{className:"text-[9px]",style:{color:"var(--text-muted)"},children:t})]})}var Y=a(8421),Q=a(642),ee=a(6296),et=a(2484),ea=a(2791),er=a(9220),es=a(2651),el=a(3195),ei=a(2032),eo=a(3024),en=a(4898);let ed={activation:{label:"Activation",color:"#f0883e",icon:"⚡",description:"Wrong activation function for layer or task"},layer:{label:"Layer",color:"#79c0ff",icon:"\uD83E\uDDF1",description:"Incorrect layer type, config, or missing layers"},hyperparameter:{label:"Hyperparameter",color:"#d2a8ff",icon:"\uD83C\uDF9B",description:"Incorrect learning rate, batch size, or epochs"},loss:{label:"Loss Function",color:"#ffa657",icon:"\uD83D\uDCC9",description:"Inappropriate loss function for the task"},optimization:{label:"Optimization",color:"#56d364",icon:"\uD83D\uDD27",description:"Wrong optimizer or misconfigured optimization"},regularizer:{label:"Regularization",color:"#f778ba",icon:"\uD83D\uDEE1",description:"Incorrect regularization parameters"},weights:{label:"Weights",color:"#a5d6ff",icon:"⚖️",description:"Poor or incorrect weight initialization"}};function ec({status:e,size:t=14}){return"active"===e?(0,r.jsx)(ee.A,{size:t,className:"animate-spin",style:{color:"var(--accent)"}}):"done"===e?(0,r.jsx)(et.A,{size:t,style:{color:"var(--safe-green)"}}):"skipped"===e?(0,r.jsx)(ea.A,{size:t,style:{color:"var(--text-muted)",opacity:.4}}):(0,r.jsx)("div",{style:{width:t,height:t,borderRadius:"50%",border:"1.5px solid var(--border-subtle)",background:"var(--bg-overlay)",flexShrink:0}})}function ex({lit:e=!1,height:t=22}){return(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",height:t},children:(0,r.jsx)("div",{style:{width:2,height:"100%",background:e?"var(--accent)":"var(--border-subtle)",borderRadius:1,transition:"background 0.4s ease"}})})}function eu({show:e,isFaulty:t}){return e?(0,r.jsxs)("div",{style:{position:"relative",height:48},children:[(0,r.jsx)("div",{style:{position:"absolute",top:0,left:"50%",transform:"translateX(-50%)",width:2,height:16,background:"var(--border-subtle)",borderRadius:1}}),(0,r.jsx)("div",{style:{position:"absolute",top:16,left:"22%",right:"22%",height:2,background:"var(--border-subtle)"}}),(0,r.jsx)("div",{style:{position:"absolute",top:16,left:"22%",width:2,height:20,background:t?"var(--fault-red)":"var(--border-subtle)",borderRadius:1,transition:"background 0.3s"}}),(0,r.jsx)("div",{style:{position:"absolute",top:16,right:"22%",width:2,height:20,background:t?"var(--border-subtle)":"var(--safe-green)",borderRadius:1,transition:"background 0.3s"}}),(0,r.jsx)("div",{style:{position:"absolute",top:17,left:"4%",fontSize:8,fontWeight:700,letterSpacing:"0.07em",textTransform:"uppercase",color:t?"var(--fault-red)":"var(--text-muted)",transition:"color 0.3s"},children:"Faulty"}),(0,r.jsx)("div",{style:{position:"absolute",top:17,right:"4%",fontSize:8,fontWeight:700,letterSpacing:"0.07em",textTransform:"uppercase",color:t?"var(--text-muted)":"var(--safe-green)",transition:"color 0.3s"},children:"Correct"})]}):(0,r.jsx)(ex,{height:22})}function ep({stageNum:e,icon:t,title:a,question:s,status:l,result:i,dimmed:o=!1}){let n="active"===l,d="done"===l;return(0,r.jsxs)(Y.P.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.22},style:{border:`1px solid ${n?"var(--accent)":d?"var(--border)":"var(--border-subtle)"}`,borderRadius:10,background:n?"var(--bg-overlay)":"var(--bg-card)",boxShadow:n?"0 0 0 1px var(--accent), 0 4px 20px rgba(88,166,255,0.08)":"none",padding:"9px 12px",opacity:"skipped"===l?.42:o?.65:1,transition:"all 0.3s ease"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:7,marginBottom:4},children:[void 0!==e&&(0,r.jsxs)("span",{style:{fontSize:8,fontWeight:800,letterSpacing:"0.06em",padding:"2px 5px",borderRadius:4,background:n?"var(--accent)":"var(--bg-overlay)",color:n?"#fff":"var(--text-muted)",border:`1px solid ${n?"var(--accent)":"var(--border-subtle)"}`,flexShrink:0},children:["S",e]}),(0,r.jsx)("span",{style:{color:"var(--text-muted)",flexShrink:0,lineHeight:1},children:t}),(0,r.jsx)("span",{style:{fontSize:11,fontWeight:600,flex:1,color:n?"var(--accent)":d?"var(--text-primary)":"var(--text-muted)"},children:a}),(0,r.jsx)(ec,{status:l,size:13})]}),(0,r.jsx)("div",{style:{fontSize:10,color:"var(--text-muted)",paddingLeft:2,marginBottom:2},children:s}),"skipped"===l&&(0,r.jsx)("div",{style:{fontSize:9,color:"var(--text-muted)",marginTop:4,fontStyle:"italic"},children:"Requires training data"}),(0,r.jsx)(Q.N,{children:i&&(0,r.jsx)(Y.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.28,delay:.08},style:{overflow:"hidden"},children:(0,r.jsx)("div",{style:{borderTop:"1px solid var(--border-subtle)",marginTop:8,paddingTop:8},children:i})},"result")})]})}function em({categories:e}){return e.length?(0,r.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:4},children:e.map(e=>{let t=ed[e.toLowerCase()];return(0,r.jsxs)("span",{style:{fontSize:9,fontWeight:700,padding:"2px 6px",borderRadius:4,background:"var(--fault-red-bg)",border:"1px solid rgba(248,81,73,0.3)",color:t?.color??"var(--fault-red)"},children:[t?.icon," ",t?.label??e]},e)})}):(0,r.jsxs)("span",{style:{fontSize:10,color:"var(--safe-green)",display:"flex",alignItems:"center",gap:5},children:[(0,r.jsx)(et.A,{size:11}),"No fault categories flagged"]})}function eh(){return(0,r.jsxs)(Y.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.25},style:{padding:"10px 16px",borderRadius:10,textAlign:"center",border:"1px solid var(--safe-green)",background:"var(--safe-green-bg)"},children:[(0,r.jsx)(et.A,{size:22,style:{color:"var(--safe-green)",margin:"0 auto 5px"}}),(0,r.jsx)("div",{style:{fontSize:12,fontWeight:700,color:"var(--safe-green)"},children:"Model Looks Correct"}),(0,r.jsx)("div",{style:{fontSize:9,color:"var(--text-muted)",marginTop:3},children:"No fault detected in Stage 1"})]})}function ef({mode:e,currentStage:t,detectionProb:a,detectionPositive:l,flaggedCategories:i,topRootCause:o}){let[n,d]=(0,s.useState)(1),c=(0,s.useRef)(null),{s1:x,s2:u,s3:p,isRunning:m,isDone:h}=function(e,t){let a="analyzing_static"===e||"analyzing_full"===e||"training"===e,r="done_static"===e||"done_full"===e||"done_training"===e;function s(s){return"idle"===e||"error"===e?"idle":a&&t===s?"active":a&&s<t?"done":"done_static"===e?3===s?"done":"skipped":r?"done":"idle"}return{s1:s(1),s2:s(2),s3:s(3),isRunning:a,isDone:r}}(e,t),f="done_static"===e,g=h&&!f,v=!0===l,y=(0,s.useCallback)(e=>{d(t=>Math.max(.5,Math.min(1.8,parseFloat((t+e).toFixed(1)))))},[]);(0,s.useEffect)(()=>{let e=c.current;if(e)return e.addEventListener("wheel",t,{passive:!1}),()=>e.removeEventListener("wheel",t);function t(e){(e.ctrlKey||e.metaKey)&&(e.preventDefault(),y(e.deltaY>0?-.1:.1))}},[y]);let b="done"===x?(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:7,flexWrap:"wrap"},children:[void 0!==a&&(0,r.jsxs)("span",{style:{fontFamily:"var(--font-mono, monospace)",fontSize:10,color:"var(--text-code)"},children:["P = ",(100*a).toFixed(1),"%"]}),void 0!==l&&(0,r.jsx)("span",{style:{fontSize:9,fontWeight:700,padding:"2px 8px",borderRadius:20,background:l?"var(--fault-red-bg)":"var(--safe-green-bg)",color:l?"var(--fault-red)":"var(--safe-green)",border:`1px solid ${l?"var(--fault-red)":"var(--safe-green)"}`},children:l?"FAULT DETECTED":"LOOKS CORRECT"}),f&&(0,r.jsx)("span",{style:{fontSize:9,color:"var(--text-muted)",fontStyle:"italic"},children:"Train model to unlock"})]}):void 0,j="done"===u&&void 0!==i?(0,r.jsx)(em,{categories:i}):void 0,N="done"===p?(0,r.jsx)("div",{style:{display:"flex",alignItems:"center",gap:6},children:o?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{style:{fontSize:9,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Top cause:"}),(0,r.jsx)("span",{style:{fontFamily:"var(--font-mono, monospace)",fontSize:10,color:"var(--text-code)"},children:o})]}):(0,r.jsx)("span",{style:{fontSize:10,color:"var(--text-muted)"},children:"See SHAP chart for details"})}):void 0;return(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsx)("span",{style:{fontSize:9,fontWeight:700,letterSpacing:"0.1em",textTransform:"uppercase",color:"var(--text-muted)"},children:"Fault Diagnosis Tree"}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)("button",{className:"btn-ghost",style:{padding:"3px 5px",borderRadius:5},onClick:()=>y(-.1),disabled:n<=.5,title:"Zoom out (Ctrl+Scroll)","aria-label":"Zoom out",children:(0,r.jsx)(er.A,{size:10})}),(0,r.jsxs)("button",{style:{fontSize:9,fontFamily:"monospace",minWidth:36,textAlign:"center",padding:"2px 4px",borderRadius:4,background:1!==n?"var(--accent)":"var(--bg-overlay)",color:1!==n?"#fff":"var(--text-muted)",border:`1px solid ${1!==n?"var(--accent)":"var(--border-subtle)"}`,cursor:"pointer",transition:"all 0.2s"},onClick:()=>d(1),title:"Reset zoom","aria-label":`Current zoom ${Math.round(100*n)}%. Click to reset.`,children:[Math.round(100*n),"%"]}),(0,r.jsx)("button",{className:"btn-ghost",style:{padding:"3px 5px",borderRadius:5},onClick:()=>y(.1),disabled:n>=1.8,title:"Zoom in (Ctrl+Scroll)","aria-label":"Zoom in",children:(0,r.jsx)(es.A,{size:10})})]})]}),(0,r.jsx)("div",{ref:c,style:{overflow:"auto",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-base)",minHeight:180,maxHeight:440},role:"region","aria-label":"Fault diagnosis tree visualization",children:(0,r.jsxs)("div",{style:{transform:`scale(${n})`,transformOrigin:"top center",transition:"transform 0.18s ease",padding:"14px 16px 16px",minWidth:230},children:[(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",marginBottom:0},children:(0,r.jsxs)(Y.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.2},style:{display:"flex",alignItems:"center",gap:6,fontSize:9,fontWeight:800,letterSpacing:"0.1em",textTransform:"uppercase",color:"idle"===e?"var(--text-muted)":"var(--text-secondary)",padding:"5px 14px",borderRadius:6,border:"1px solid var(--border-subtle)",background:"var(--bg-card)",transition:"all 0.3s"},children:[(0,r.jsx)(el.A,{size:11,"aria-hidden":"true"}),"DNN Fault Diagnosis"]})}),(0,r.jsx)(ex,{lit:"active"===x||"done"===x,height:20}),(0,r.jsx)(ep,{stageNum:1,icon:(0,r.jsx)(ei.A,{size:12}),title:"Fault Detection",question:"Is the DNN faulty?",status:x,result:b}),(0,r.jsx)(eu,{show:g,isFaulty:v}),g&&!v?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eh,{}),(0,r.jsx)(ex,{height:20}),(0,r.jsx)(ep,{stageNum:2,icon:(0,r.jsx)(eo.A,{size:12}),title:"Fault Categorization",question:"What type of fault?",status:u,result:j,dimmed:!0}),(0,r.jsx)(ex,{lit:"done"===p,height:20}),(0,r.jsx)(ep,{stageNum:3,icon:(0,r.jsx)(en.A,{size:12}),title:"Root Cause Analysis",question:"Why is the DNN faulty?",status:p,result:N,dimmed:!0})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ep,{stageNum:2,icon:(0,r.jsx)(eo.A,{size:12}),title:"Fault Categorization",question:"What type of fault?",status:u,result:j}),(0,r.jsx)(ex,{lit:"active"===p||"done"===p,height:20}),(0,r.jsx)(ep,{stageNum:3,icon:(0,r.jsx)(en.A,{size:12}),title:"Root Cause Analysis",question:"Why is the DNN faulty?",status:p,result:N})]})]})}),(0,r.jsx)("div",{style:{fontSize:9,color:"var(--text-muted)",textAlign:"right"},children:"Ctrl+scroll or use +/- to zoom"})]})}function eg({probability:e,threshold:t,isFault:a}){let l,i,o,n,d=Math.min(Math.max(e,0),1);function c(e,t){let a=e*Math.PI/180;return{x:80+t*Math.cos(a),y:80+t*Math.sin(a)}}let x=(0,s.useMemo)(()=>{let e,t;return e=c(-225,60),t=c(-225+270*d,60),`M ${e.x} ${e.y} A 60 60 0 ${+(270*d>180)} 1 ${t.x} ${t.y}`},[d]),u=(0,s.useMemo)(()=>{let e=c(-225,60),t=c(45,60);return`M ${e.x} ${e.y} A 60 60 0 1 1 ${t.x} ${t.y}`},[]),p=a?d>.8?"#f85149":d>.6?"#ff7b72":"#ffa657":"#3fb950";return(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsxs)("svg",{width:160,height:140,viewBox:"0 0 160 140",children:[(0,r.jsx)("path",{d:u,fill:"none",stroke:"var(--border)",strokeWidth:10,strokeLinecap:"round"}),(i=c(l=-225+270*t,53),o=c(l,67),(0,r.jsx)("line",{x1:i.x,y1:i.y,x2:o.x,y2:o.y,stroke:"var(--warn-yellow)",strokeWidth:2,strokeDasharray:"3 2"})),(0,r.jsx)(Y.P.path,{d:x,fill:"none",stroke:p,strokeWidth:10,strokeLinecap:"round",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:.8,ease:"easeOut"}}),(0,r.jsxs)("text",{x:80,y:76,textAnchor:"middle",fill:"var(--text-primary)",fontSize:22,fontWeight:"700",fontFamily:"JetBrains Mono, monospace",children:[(100*d).toFixed(0),"%"]}),(0,r.jsx)("text",{x:80,y:94,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:9,fontFamily:"Inter, sans-serif",children:"fault probability"}),(0,r.jsx)("text",{x:20,y:132,fill:"var(--text-muted)",fontSize:9,textAnchor:"middle",children:"0%"}),(0,r.jsx)("text",{x:140,y:132,fill:"var(--text-muted)",fontSize:9,textAnchor:"middle",children:"100%"}),(n=c(-225+270*t,40),(0,r.jsxs)("text",{x:n.x,y:n.y,textAnchor:"middle",fill:"var(--warn-yellow)",fontSize:8,fontFamily:"JetBrains Mono, monospace",children:["τ=",t.toFixed(2)]}))]}),(0,r.jsx)(Y.P.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},transition:{delay:.5},className:"text-xs font-semibold px-3 py-1 rounded-full mt-1",style:{background:a?"var(--fault-red-bg)":"var(--safe-green-bg)",color:a?"var(--fault-red)":"var(--safe-green)",border:`1px solid ${a?"var(--fault-red)":"var(--safe-green)"}`,letterSpacing:"0.05em"},children:a?"FAULT DETECTED":"MODEL LOOKS CORRECT"})]})}function ev({categories:e}){let t=[...e].sort((e,t)=>t.probability-e.probability);return(0,r.jsxs)("div",{className:"flex flex-col gap-1.5",children:[t.map((e,t)=>{let a=ed[e.name],s=Math.max(100*e.probability,0),l=e.predicted_positive,i=100*e.threshold;return(0,r.jsxs)(Y.P.div,{initial:{opacity:0,x:-12},animate:{opacity:1,x:0},transition:{delay:.05*t},className:"group",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-0.5",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("span",{className:"text-xs",children:a.icon}),(0,r.jsx)("span",{className:"text-xs font-medium",style:{color:l?a.color:"var(--text-secondary)"},children:a.label}),l&&(0,r.jsx)("span",{className:"text-[10px] px-1.5 py-0 rounded-full font-semibold",style:{background:`${a.color}20`,color:a.color,border:`1px solid ${a.color}60`},children:"FLAGGED"})]}),(0,r.jsxs)("span",{className:"text-xs font-mono",style:{color:l?a.color:"var(--text-muted)"},children:[(100*e.probability).toFixed(1),"%"]})]}),(0,r.jsxs)("div",{className:"relative h-2 rounded-full overflow-visible",style:{background:"var(--border-subtle)"},children:[(0,r.jsx)(Y.P.div,{className:"absolute top-0 left-0 h-full rounded-full",initial:{width:0},animate:{width:`${s}%`},transition:{duration:.5,ease:"easeOut",delay:.05*t+.1},style:{background:l?`linear-gradient(90deg, ${a.color}80, ${a.color})`:"var(--border)"}}),(0,r.jsx)("div",{className:"absolute top-[-3px] w-px h-[14px] rounded-sm",style:{left:`${i}%`,background:"var(--warn-yellow)",opacity:.7},title:`Threshold: ${(100*e.threshold).toFixed(1)}%`})]})]},e.name)}),(0,r.jsxs)("div",{className:"flex items-center gap-3 mt-2 pt-2",style:{borderTop:"1px solid var(--border-subtle)"},children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("div",{className:"w-3 h-0.5 rounded",style:{background:"var(--warn-yellow)"}}),(0,r.jsx)("span",{className:"text-[10px]",style:{color:"var(--text-muted)"},children:"threshold (τ)"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("div",{className:"w-3 h-1.5 rounded",style:{background:"var(--accent)"}}),(0,r.jsx)("span",{className:"text-[10px]",style:{color:"var(--text-muted)"},children:"below threshold"})]})]})]})}function ey({features:e,baseValue:t,predictedProbability:a}){let l=(0,s.useMemo)(()=>{let a=[...e].sort((e,t)=>t.abs_shap-e.abs_shap),r=t;return a.map(e=>{let t=r,a=r+e.shap_value;return r=a,{...e,start:t,end:a}})},[e,t]),i=[t,a,...l.flatMap(e=>[e.start,e.end])],o=Math.max(0,Math.min(...i)-.05),n=Math.min(1,Math.max(...i)+.05)-o||.01;l.length;let d=(e,t)=>(e-o)/n*t;return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wider mb-3",style:{color:"var(--text-secondary)"},children:"SHAP Waterfall: Root Cause"}),(0,r.jsxs)("div",{className:"text-[10px] mb-2 flex gap-4",children:[(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"inline-block w-3 h-2 rounded-sm",style:{background:"var(--shap-pos)"}}),(0,r.jsx)("span",{style:{color:"var(--text-muted)"},children:"pushes toward buggy"})]}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"inline-block w-3 h-2 rounded-sm",style:{background:"var(--shap-neg)"}}),(0,r.jsx)("span",{style:{color:"var(--text-muted)"},children:"pushes toward correct"})]})]}),(0,r.jsx)("div",{className:"w-full overflow-x-auto",children:(0,r.jsxs)("div",{style:{minWidth:420},children:[(0,r.jsxs)("div",{className:"flex text-[9px] uppercase tracking-wider pb-1 mb-1",style:{borderBottom:"1px solid var(--border-subtle)",color:"var(--text-muted)"},children:[(0,r.jsx)("div",{style:{width:160,flexShrink:0},children:"Feature"}),(0,r.jsx)("div",{className:"flex-1"}),(0,r.jsx)("div",{style:{width:56,flexShrink:0,textAlign:"right"},children:"SHAP"})]}),l.map((e,t)=>(0,r.jsx)(eb,{row:e,index:t,domainMin:o,domainSpan:n,labelWidth:160,valueWidth:56,barHeight:22,barGap:6,minBarPx:3,toX:d,svgWidth:void 0},e.feature)),(0,r.jsx)(eN,{predictedProbability:a,baseValue:t,domainMin:o,domainSpan:n,labelWidth:160,valueWidth:56,barHeight:22,barGap:6}),(0,r.jsxs)("div",{className:"text-[10px] mt-1 font-mono",style:{color:"var(--text-muted)",paddingLeft:160},children:["E[f(x)] = ",t.toFixed(4)]})]})})]})}function eb({row:e,domainMin:t,domainSpan:a,labelWidth:s,valueWidth:l,barHeight:i,barGap:o,minBarPx:n}){var d,c;let x=e.shap_value>=0,u=x?"var(--shap-pos)":"var(--shap-neg)";return(0,r.jsxs)("div",{className:"flex items-center group",style:{marginBottom:o,height:i},title:e.hint,children:[(0,r.jsxs)("div",{className:"font-mono text-[10px] truncate pr-2 flex-shrink-0",style:{width:s,color:"var(--text-secondary)"},children:[e.feature,(0,r.jsxs)("span",{style:{color:"var(--text-muted)",marginLeft:4},children:["= ",.001>Math.abs(d=e.feature_value)?d.toExponential(1):Number.isInteger(d)?String(d):d.toFixed(3)]})]}),(0,r.jsx)("div",{className:"flex-1 relative flex items-center",style:{height:i},children:(0,r.jsx)(ej,{start:e.start,end:e.end,domainMin:t,domainSpan:a,barHeight:i,color:u,bgColor:x?"var(--fault-red-bg)":"var(--safe-green-bg)",minBarPx:n})}),(0,r.jsx)("div",{className:"font-mono text-[10px] flex-shrink-0 text-right",style:{width:l,color:u},children:((c=e.shap_value)>=0?"+":"")+c.toFixed(4)})]})}function ej({start:e,end:t,domainMin:a,domainSpan:s,barHeight:l,color:i,bgColor:o,minBarPx:n}){let d,c,x,u,p,m,h;return(0,r.jsxs)("svg",{className:"w-full",height:l,preserveAspectRatio:"none",viewBox:`0 0 100 ${l}`,children:[(0,r.jsx)("rect",{x:0,y:l/2-1,width:100,height:1.5,fill:"var(--border-subtle)"}),(x=Math.min(d=(e-a)/s*100,c=(t-a)/s*100),u=Math.max(Math.max(d,c)-x,n/1*.5),p=.55*l,m=(l-p)/2,(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("rect",{x:`${x}%`,y:m,width:`${u}%`,height:p,fill:o,rx:2}),(0,r.jsx)("rect",{x:`${x}%`,y:m,width:`${u}%`,height:p,fill:i,fillOpacity:.75,rx:2})]})),(h=(t-a)/s*100,(0,r.jsx)("line",{x1:`${h}%`,y1:0,x2:`${h}%`,y2:l,stroke:i,strokeWidth:1.5}))]})}function eN({predictedProbability:e,baseValue:t,domainMin:a,domainSpan:s,labelWidth:l,valueWidth:i,barHeight:o,barGap:n}){let d=e>t?"var(--shap-pos)":"var(--shap-neg)",c=(t-a)/s*100,x=(e-a)/s*100,u=Math.min(c,x),p=Math.abs(x-c),m=.65*o,h=(o-m)/2;return(0,r.jsxs)("div",{className:"flex items-center",style:{marginTop:n+4,height:o,borderTop:"1px dashed var(--border-subtle)",paddingTop:n},children:[(0,r.jsx)("div",{className:"font-mono text-[10px] flex-shrink-0 pr-2",style:{width:l,color:"var(--text-muted)"},children:"f(x) \xb7 predicted"}),(0,r.jsx)("div",{className:"flex-1 relative",style:{height:o},children:(0,r.jsxs)("svg",{className:"w-full",height:o,preserveAspectRatio:"none",viewBox:`0 0 100 ${o}`,children:[(0,r.jsx)("rect",{x:0,y:o/2-.75,width:100,height:1.5,fill:"var(--border-subtle)"}),(0,r.jsx)("rect",{x:`${u}%`,y:h,width:`${p}%`,height:m,fill:d,fillOpacity:.9,rx:2}),(0,r.jsx)("line",{x1:`${x}%`,y1:0,x2:`${x}%`,y2:o,stroke:d,strokeWidth:2})]})}),(0,r.jsx)("div",{className:"font-mono text-[10px] flex-shrink-0 text-right",style:{width:i,color:d},children:e.toFixed(4)})]})}function ek({root:e,flaggedCategories:t,topShapFeatures:a}){let s=new Set(t.map(e=>e.toLowerCase())),l=new Set(a.map(e=>e.toLowerCase()));return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wider mb-3",style:{color:"var(--text-secondary)"},children:"Fault Taxonomy"}),(0,r.jsxs)("div",{className:"text-[10px] mb-2 flex gap-3 flex-wrap",children:[t.length>0&&t.map(e=>{let t=ed[e.toLowerCase()];return(0,r.jsxs)("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-medium uppercase",style:{background:"var(--fault-red-bg)",color:"var(--fault-red)",border:"1px solid var(--fault-red)"},children:[t?.icon," ",t?.label??e]},e)}),0===t.length&&(0,r.jsx)("span",{style:{color:"var(--text-muted)"},children:"No categories flagged"})]}),(0,r.jsx)(ew,{node:e,depth:0,flaggedSet:s,shapSet:l,defaultOpen:!0})]})}function ew({node:e,depth:t,flaggedSet:a,shapSet:l,defaultOpen:i=!1}){let[o,n]=(0,s.useState)(i||t<1),d=null!=e.fault_category&&a.has(e.fault_category.toLowerCase()),c=l.has(e.id.toLowerCase())||l.has(e.label.toLowerCase()),x=e.children.length>0,u=(0,s.useCallback)(()=>{x&&n(e=>!e)},[x]),p=e.fault_category?ed[e.fault_category.toLowerCase()]:null,m=14*t;return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-start gap-1 py-0.5 rounded cursor-pointer group",style:{paddingLeft:m,paddingRight:4},onClick:u,children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-0.5",style:{width:14,color:"var(--text-muted)"},children:x?o?(0,r.jsx)(T.A,{size:10}):(0,r.jsx)(W.A,{size:10}):(0,r.jsx)("span",{style:{display:"inline-block",width:10}})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5 flex-wrap",children:[p&&(0,r.jsx)("span",{className:"inline-block w-2 h-2 rounded-full flex-shrink-0",style:{background:p.color}}),(0,r.jsx)("span",{className:"text-[11px] font-medium truncate",style:{color:d?"var(--fault-red)":c?"var(--accent)":0===t?"var(--text-primary)":"var(--text-secondary)"},children:e.label}),d&&(0,r.jsx)("span",{className:"text-[8px] px-1 py-0.5 rounded uppercase font-bold flex-shrink-0",style:{background:"var(--fault-red-bg)",color:"var(--fault-red)"},children:"flagged"}),c&&!d&&(0,r.jsx)("span",{className:"text-[8px] px-1 py-0.5 rounded uppercase font-bold flex-shrink-0",style:{background:"rgba(88,166,255,0.15)",color:"var(--accent)"},children:"top cause"})]}),(d||0===t)&&e.description&&(0,r.jsx)("div",{className:"text-[9px] mt-0.5 leading-relaxed",style:{color:"var(--text-muted)"},children:e.description})]})]}),x&&o&&(0,r.jsx)("div",{style:{borderLeft:0===t?"none":"1px solid var(--border-subtle)",marginLeft:m+6},children:e.children.map(e=>(0,r.jsx)(ew,{node:e,depth:t+1,flaggedSet:a,shapSet:l},e.id))})]})}var eS=a(7635);function ez({stage3:e,stage2:t,warnings:a}){let s=null!=e&&e.top_features.length>0,l=null!=t&&t.flagged.length>0;return s||l||a?.length?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wider mb-3",style:{color:"var(--text-secondary)"},children:"Insights & Fix Suggestions"}),a?.map((e,t)=>(0,r.jsx)(eC,{message:e},t)),e&&(0,r.jsx)(eA,{probabilityBuggy:e.probability_buggy,threshold:e.threshold,predicted:e.predicted_buggy}),l&&t&&(0,r.jsx)("div",{className:"space-y-1.5",children:t.flagged.map(e=>{let a=t.categories.find(t=>t.name.toLowerCase()===e.toLowerCase());return a?(0,r.jsx)(eF,{name:e,probability:a.probability,threshold:a.threshold},e):null})}),s&&e&&(0,r.jsx)("div",{className:"space-y-1.5 mt-2",children:e.top_features.map(e=>(0,r.jsx)(e_,{feature:e},e.feature))})]}):(0,r.jsx)("div",{className:"text-[11px] text-center py-6",style:{color:"var(--text-muted)"},children:"No insights yet. Run an analysis first."})}function eC({message:e}){return(0,r.jsxs)("div",{className:"flex items-start gap-2 text-[11px] px-3 py-2 rounded-md",style:{background:"var(--warn-yellow-bg)",border:"1px solid var(--warn-yellow)",color:"var(--warn-yellow)"},children:[(0,r.jsx)(u.A,{size:12,className:"flex-shrink-0 mt-0.5"}),(0,r.jsx)("span",{children:e})]})}function eA({probabilityBuggy:e,threshold:t,predicted:a}){let s=(100*e).toFixed(1),l=a?"var(--fault-red)":"var(--safe-green)",i=a?u.A:et.A;return(0,r.jsxs)("div",{className:"flex items-center gap-3 px-3 py-2.5 rounded-md",style:{background:a?"var(--fault-red-bg)":"var(--safe-green-bg)",border:`1px solid ${a?"var(--fault-red)":"var(--safe-green)"}`},children:[(0,r.jsx)(i,{size:18,style:{color:l,flexShrink:0}}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-[12px] font-semibold",style:{color:l},children:a?"Fault Detected":"Model Looks Correct"}),(0,r.jsxs)("div",{className:"text-[10px] font-mono",style:{color:"var(--text-muted)"},children:["P(buggy) = ",s,"% \xb7 threshold = ",(100*t).toFixed(0),"%"]})]})]})}function eF({name:e,probability:t,threshold:a}){let s=ed[e.toLowerCase()],l=s?.label??e,i=s?.color??"var(--fault-red)",o=s?.description??"";return(0,r.jsxs)("div",{className:"px-3 py-2 rounded-md text-[11px]",style:{background:"rgba(248,81,73,0.08)",border:"1px solid rgba(248,81,73,0.25)"},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-0.5",children:[(0,r.jsx)("span",{style:{color:i},children:s?.icon??"⚠️"}),(0,r.jsxs)("span",{className:"font-semibold",style:{color:i},children:[l," Fault"]}),(0,r.jsxs)("span",{className:"ml-auto font-mono text-[10px]",style:{color:"var(--text-muted)"},children:[(100*t).toFixed(1),"% > ",(100*a).toFixed(0),"% τ"]})]}),o&&(0,r.jsx)("div",{style:{color:"var(--text-muted)"},children:o})]})}function e_({feature:e}){let[t,a]=(0,s.useState)(!1),[l,i]=(0,s.useState)(!1),o=e.shap_value>=0;return(0,r.jsxs)("div",{className:"rounded-md overflow-hidden",style:{border:"1px solid var(--border)"},children:[(0,r.jsxs)("button",{className:"w-full flex items-center gap-2 px-3 py-2 text-left",style:{background:o?"var(--fault-red-bg)":"var(--safe-green-bg)"},onClick:()=>a(e=>!e),children:[t?(0,r.jsx)(T.A,{size:10,style:{color:"var(--text-muted)",flexShrink:0}}):(0,r.jsx)(W.A,{size:10,style:{color:"var(--text-muted)",flexShrink:0}}),(0,r.jsx)("span",{className:"font-mono text-[10px] flex-1 text-left truncate",style:{color:"var(--text-secondary)"},children:e.feature}),(0,r.jsx)("span",{className:"font-mono text-[10px] flex-shrink-0",style:{color:o?"var(--shap-pos)":"var(--shap-neg)"},children:(e.shap_value>=0?"+":"")+e.shap_value.toFixed(4)}),(0,r.jsxs)("span",{className:"text-[9px] flex-shrink-0 ml-1",style:{color:"var(--text-muted)"},children:["val=",e.feature_value.toFixed(2)]})]}),t&&(0,r.jsxs)("div",{className:"px-3 py-2.5",style:{background:"var(--bg-card)",borderTop:"1px solid var(--border-subtle)"},children:[(0,r.jsx)("div",{className:"text-[11px] leading-relaxed mb-2",style:{color:"var(--text-secondary)"},children:e.hint}),(0,r.jsxs)("button",{className:"flex items-center gap-1.5 text-[10px] px-2 py-1 rounded",style:{background:"var(--bg-overlay)",border:"1px solid var(--border)",color:l?"var(--safe-green)":"var(--text-muted)"},onClick:function(){navigator.clipboard.writeText(e.hint).then(()=>{i(!0),setTimeout(()=>i(!1),2e3)})},children:[l?(0,r.jsx)(w.A,{size:10}):(0,r.jsx)(eS.A,{size:10}),l?"Copied!":"Copy hint"]})]})]})}function eD(){let e=h(),{code:t,modelName:a,mode:p,currentStage:m,codeResult:f,fullResult:g,error:j,warnings:N,taxonomy:w,dataMode:S,uploadedFile:z,trainingEpochs:C,numSamples:A,liveMetrics:F,isDummyData:_,abortController:E,setCode:M,setModelName:R,setMode:L,setCurrentStage:T,setCodeResult:W,setFullResult:O,setError:I,setWarnings:B,setTaxonomy:K,setDataMode:H,setUploadedFile:J,setTrainingConfig:U,appendEpochMetric:q,setIsDummyData:G,setAbortController:V,resetTraining:X,loadSession:Y}=e,[Q,ee]=(0,s.useState)("editor"),et="analyzing_static"===p||"analyzing_full"===p||"training"===p,ea="done_static"===p||"done_full"===p||"done_training"===p,er=g?.stage3_static??f?.stage3_static??null,es=g?.stage1_detection??null,el=g?.stage2_categories??null;(0,s.useEffect)(()=>{ea&&k({code:t,modelName:a,dataMode:S,trainingEpochs:C,numSamples:A,fullResult:g,codeResult:f,liveMetrics:F,isDummyData:_,name:"Draft"})},[ea]),(0,s.useEffect)(()=>{ea&&ee("results")},[ea]),(0,s.useEffect)(()=>{"training"===p&&ee("pipeline")},[p]),(0,s.useEffect)(()=>{y().then(K).catch(()=>{})},[]),(0,s.useEffect)(()=>()=>{E?.abort()},[E]);let ei=(0,s.useCallback)(async()=>{if(t.trim()&&!et){L("analyzing_static"),T(3),I(null),W(null),O(null),B([]);try{let e=await v(t.trim(),a);W(e),B(e.warnings??[]),L("done_static")}catch(e){L("error"),I(e instanceof Error?e.message:String(e))}finally{T(0)}}},[t,a,et,L,T,I,W,O,B]),eo=(0,s.useCallback)(async()=>{if(!t.trim()||et)return;if("uploaded"===S&&!z)return void I("Please upload a dataset file first.");let e=new AbortController;V(e),X(),L("training"),T(1),I(null),W(null),O(null),B([]),G("dummy"===S);try{for await(let r of b({code:t.trim(),modelName:a,dataMode:S,epochs:C,numSamples:A,datasetFile:z},e.signal))"epoch"===r.type?q(r):"analyzing"===r.type?T(r.stage):"complete"===r.type?(O(r.result),G("dummy"===r.data_mode),B(r.result.warnings??[]),L("done_training")):"error"===r.type&&(I(r.message),L("error"))}catch(e){"AbortError"!==e.name&&(L("error"),I(e instanceof Error?e.message:String(e)))}finally{T(0),V(null)}},[t,a,et,S,z,C,A,V,X,L,T,I,W,O,B,G,q]);return(0,s.useEffect)(()=>{function e(e){(e.metaKey||e.ctrlKey)&&"Enter"===e.key&&(e.preventDefault(),ei())}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ei]),(0,r.jsxs)("div",{className:"min-h-screen md:h-screen flex flex-col md:overflow-hidden",style:{background:"var(--bg-base)",color:"var(--text-primary)"},children:[(0,r.jsxs)("header",{role:"banner",className:"flex items-center gap-3 px-4 md:px-5 py-2.5 flex-shrink-0",style:{background:"var(--bg-card)",borderBottom:"1px solid var(--border)"},children:[(0,r.jsx)(l.A,{size:15,"aria-hidden":"true",style:{color:"var(--accent)"}}),(0,r.jsxs)("div",{className:"flex flex-col leading-tight",children:[(0,r.jsx)("span",{className:"font-semibold text-sm tracking-tight",children:"DEFault"}),(0,r.jsx)("span",{className:"text-[9px] uppercase tracking-widest hidden sm:block",style:{color:"var(--text-muted)"},children:"Detection & Explain Fault"})]}),(0,r.jsxs)("div",{className:"ml-auto flex items-center gap-2 md:gap-3 text-[10px]",style:{color:"var(--text-muted)"},children:[(0,r.jsxs)("span",{className:"hidden lg:flex items-center gap-1","aria-label":"Keyboard shortcut: Command Enter to check model",children:[(0,r.jsx)("kbd",{className:"px-1 py-0.5 rounded font-mono",style:{background:"var(--bg-overlay)",border:"1px solid var(--border)"},children:"⌘"}),(0,r.jsx)("span",{"aria-hidden":"true",children:"+"}),(0,r.jsx)("kbd",{className:"px-1 py-0.5 rounded font-mono",style:{background:"var(--bg-overlay)",border:"1px solid var(--border)"},children:"↵"}),(0,r.jsx)("span",{children:"check model"})]}),(0,r.jsx)(D,{currentState:{code:t,modelName:a,dataMode:S,trainingEpochs:C,numSamples:A,fullResult:g,codeResult:f,liveMetrics:F,isDummyData:_},onLoad:e=>{Y(e),ee("results")},isRunning:et,hasResults:ea}),(0,r.jsx)("label",{className:"sr-only",htmlFor:"model-name-input",children:"Model name"}),(0,r.jsx)("input",{id:"model-name-input",className:"font-mono text-[10px] px-2 py-1 rounded",style:{background:"var(--bg-input)",border:"1px solid var(--border)",color:"var(--text-secondary)",width:110,outline:"none"},value:a,onChange:e=>R(e.target.value),placeholder:"model name","aria-label":"Model name"})]})]}),(0,r.jsx)("nav",{role:"tablist","aria-label":"Panel navigation",className:"flex md:hidden border-b flex-shrink-0",style:{borderColor:"var(--border)",background:"var(--bg-card)"},children:[{id:"editor",label:"Editor",icon:(0,r.jsx)(i.A,{size:13,"aria-hidden":"true"})},{id:"pipeline",label:"Pipeline",icon:(0,r.jsx)(o.A,{size:13,"aria-hidden":"true"})},{id:"results",label:"Results",icon:(0,r.jsx)(n.A,{size:13,"aria-hidden":"true"})}].map(({id:e,label:t,icon:a})=>(0,r.jsxs)("button",{role:"tab","aria-selected":Q===e,"aria-controls":`panel-${e}`,onClick:()=>ee(e),className:"flex-1 flex items-center justify-center gap-1.5 py-2 text-xs font-medium transition-colors",style:{color:Q===e?"var(--accent)":"var(--text-muted)",borderBottom:Q===e?"2px solid var(--accent)":"2px solid transparent",background:"transparent"},children:[a,t,"results"===e&&(ea||"error"===p)&&(0,r.jsx)("span",{className:"w-1.5 h-1.5 rounded-full",style:{background:"var(--accent)"},"aria-label":"Results available"})]},e))}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row flex-1 overflow-y-auto md:overflow-hidden",children:[(0,r.jsx)("aside",{id:"panel-editor",role:"region","aria-label":"Model code editor and training configuration",className:`
            flex flex-col flex-shrink-0 overflow-y-auto
            w-full md:w-[29%] md:min-w-[270px]
            border-b md:border-b-0 md:border-r
            ${"editor"!==Q?"hidden md:flex":"flex"}
          `,style:{borderColor:"var(--border)",background:"var(--bg-card)"},children:(0,r.jsxs)("div",{className:"flex flex-col gap-3 p-4 h-full",children:[(0,r.jsxs)("div",{className:"flex flex-col",style:{flex:"1 1 280px",minHeight:0},children:[(0,r.jsx)("div",{className:"text-[9px] uppercase tracking-widest mb-1.5",style:{color:"var(--text-muted)"},id:"code-editor-label",children:"Model Code: Keras / TensorFlow"}),(0,r.jsx)("div",{className:"rounded-lg overflow-hidden",style:{border:"1px solid var(--border)",flex:1,minHeight:200},role:"group","aria-labelledby":"code-editor-label",children:(0,r.jsx)($,{value:t,onChange:M,disabled:et})})]}),(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(P,{dataMode:S,uploadedFile:z,epochs:C,numSamples:A,disabled:et,onDataModeChange:H,onFileChange:J,onEpochsChange:e=>U({epochs:e}),onNumSamplesChange:e=>U({numSamples:e})})}),j&&(0,r.jsxs)("div",{role:"alert","aria-live":"assertive",className:"flex items-start gap-2 text-[11px] px-3 py-2 rounded-md flex-shrink-0",style:{background:"var(--fault-red-bg)",border:"1px solid var(--fault-red)",color:"var(--fault-red)"},children:[(0,r.jsx)(d.A,{size:12,"aria-hidden":"true",className:"flex-shrink-0 mt-0.5"}),(0,r.jsx)("span",{className:"break-words",children:j})]}),(0,r.jsxs)("div",{className:"flex gap-2 flex-shrink-0 pt-1",role:"group","aria-label":"Analysis actions",children:[(0,r.jsxs)("button",{className:"flex-1 py-2.5 rounded-lg text-xs font-semibold flex items-center justify-center gap-1.5 transition-all",style:{background:"var(--bg-overlay)",color:et?"var(--text-muted)":"var(--text-secondary)",cursor:et?"not-allowed":"pointer",border:"1px solid var(--border)",opacity:et?.6:1},onClick:ei,disabled:et,"aria-disabled":et,"aria-label":"Check model: instant static analysis, no training required",children:[(0,r.jsx)(l.A,{size:12,"aria-hidden":"true"}),"Check Model"]}),(0,r.jsx)("button",{className:"flex-1 py-2.5 rounded-lg text-xs font-semibold flex items-center justify-center gap-1.5 transition-all",style:{background:et?"var(--bg-overlay)":"var(--accent)",color:et?"var(--text-muted)":"#fff",cursor:et?"not-allowed":"pointer",opacity:et&&"training"!==p?.6:1},onClick:eo,disabled:et,"aria-disabled":et,"aria-busy":"training"===p,"aria-label":"training"===p?"Training in progress…":"Train and diagnose: real model training with full 3-stage fault diagnosis",children:et&&"training"===p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.A,{size:12,className:"animate-spin","aria-hidden":"true"}),"Training…"]}):et?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.A,{size:12,className:"animate-spin","aria-hidden":"true"}),"Analyzing…"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.A,{size:12,"aria-hidden":"true"}),"Train & Diagnose"]})}),ea&&(0,r.jsx)("button",{className:"py-2.5 px-3 rounded-lg text-xs transition-all",style:{background:"var(--bg-overlay)",border:"1px solid var(--border)",color:"var(--text-muted)",cursor:"pointer"},onClick:()=>{e.reset(),ee("editor")},"aria-label":"Reset: clear all results and start over",children:"Reset"})]})]})}),(0,r.jsx)("main",{id:"panel-pipeline",role:"region","aria-label":"Analysis pipeline and training charts","aria-live":"polite","aria-busy":et,className:`
            flex flex-col overflow-y-auto flex-shrink-0
            w-full md:w-[35%] md:min-w-[270px]
            ${"pipeline"!==Q?"hidden md:flex":"flex"}
          `,children:(0,r.jsxs)("div",{className:"p-4 space-y-3",children:[(0,r.jsx)(eE,{children:(0,r.jsx)(ef,{currentStage:m,mode:p,detectionProb:es?.probability,detectionPositive:es?.predicted_positive,flaggedCategories:el?.flagged,topRootCause:er?.top_features[0]?.feature})}),("training"===p||"done_training"===p)&&F.length>0&&(0,r.jsx)(eE,{children:(0,r.jsx)(Z,{epochs:F,totalEpochs:C,isRunning:"training"===p,isDummyData:_})}),es&&(0,r.jsxs)(eE,{children:[(0,r.jsx)("div",{className:"text-[9px] uppercase tracking-widest mb-3",style:{color:"var(--text-muted)"},id:"detection-heading",children:"Stage 1: Fault Detection"}),(0,r.jsx)(eg,{probability:es.probability,threshold:es.threshold,isFault:es.predicted_positive})]}),el&&(0,r.jsxs)(eE,{children:[(0,r.jsx)("div",{className:"text-[9px] uppercase tracking-widest mb-3",style:{color:"var(--text-muted)"},children:"Stage 2: Fault Categories"}),(0,r.jsx)(ev,{categories:el.categories})]}),w&&(0,r.jsx)(eE,{children:(0,r.jsx)(ek,{root:w.root,flaggedCategories:el?.flagged??[],topShapFeatures:er?.top_features.map(e=>e.feature)??[]})})]})}),(0,r.jsx)("aside",{id:"panel-results",role:"region","aria-label":"SHAP explanations and fault insights","aria-live":"polite",className:`
            flex flex-col overflow-y-auto
            w-full md:flex-1 md:min-w-[230px]
            ${"results"!==Q?"hidden md:flex":"flex"}
          `,children:(0,r.jsxs)("div",{className:"p-4 space-y-3",children:[_&&"done_training"===p&&(0,r.jsxs)("div",{role:"note",className:"flex items-start gap-2 text-[11px] px-3 py-2.5 rounded-md",style:{background:"var(--warn-yellow-bg)",border:"1px solid var(--warn-yellow)",color:"var(--warn-yellow)"},children:[(0,r.jsx)(u.A,{size:12,"aria-hidden":"true",className:"flex-shrink-0 mt-0.5"}),(0,r.jsxs)("span",{children:["Results based on ",(0,r.jsx)("strong",{children:"synthetic dummy data"}),". Upload your dataset for diagnosis with real training dynamics."]})]}),er&&er.top_features.length>0&&(0,r.jsx)(eE,{children:(0,r.jsx)(ey,{features:er.top_features,baseValue:er.base_value,predictedProbability:er.probability_buggy})}),(ea||"error"===p)&&(0,r.jsx)(eE,{children:(0,r.jsx)(ez,{stage3:er,stage2:el,warnings:N})}),et&&(0,r.jsx)(eR,{}),!ea&&!et&&"error"!==p&&(0,r.jsx)(eM,{})]})})]})]})}function eE({children:e}){return(0,r.jsx)("div",{className:"rounded-lg p-4 animate-fade-in",style:{background:"var(--bg-card)",border:"1px solid var(--border)"},children:e})}function eM(){return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 px-4 text-center",role:"status","aria-label":"Ready to diagnose: no results yet",children:[(0,r.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center mb-4",style:{background:"var(--bg-card)",border:"1px solid var(--border)"},"aria-hidden":"true",children:(0,r.jsx)(l.A,{size:20,style:{color:"var(--text-muted)"}})}),(0,r.jsx)("p",{className:"text-sm font-medium mb-1.5",style:{color:"var(--text-secondary)"},children:"Ready to diagnose"}),(0,r.jsxs)("p",{className:"text-[11px] leading-relaxed",style:{color:"var(--text-muted)",maxWidth:220},children:["Paste your Keras model code, then either:",(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),(0,r.jsx)("strong",{style:{color:"var(--text-secondary)"},children:"Check Model"}),": instant static analysis (~3-5 s)",(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),(0,r.jsx)("strong",{style:{color:"var(--text-secondary)"},children:"Train & Diagnose"}),": real training + full 3-stage diagnosis with dynamic features"]})]})}function eR(){return(0,r.jsxs)("div",{className:"space-y-3",role:"status","aria-label":"Analyzing…","aria-busy":"true",children:[(0,r.jsx)("span",{className:"sr-only",children:"Analysis in progress…"}),[72,110,56,90].map((e,t)=>(0,r.jsx)("div",{className:"skeleton rounded-lg",style:{height:e},"aria-hidden":"true"},t))]})}}},e=>{e.O(0,[443,441,794,358],()=>e(e.s=4069)),_N_E=e.O()}]);